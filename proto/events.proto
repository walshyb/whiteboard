syntax = "proto3";

package events;

option go_package = "github.com/walshyb/whiteboard/proto;events";

message ClientMessage {
  string client_id = 1;

  // Used by the server to identify the publishing instance.
  // Go server sets this BEFORE publishing to Redis.
  optional string server_id = 2; 

  oneof event_type {
    MouseEvent mouse_event = 9; 
    AddShapeEvent add_shape = 10;
    UpdateShapeEvent update_shape = 11;
    RemoveShapeEvent remove_shape = 12;
    GetBoardEvent board = 13;
    ClientConnectEvent client_connected = 14;
    ClientDisconnectEvent client_disconnect = 15;
  }
}

message ServerMessage {
  string sender_name = 1;

  // Only for handshakes
  string client_id = 2;

  oneof event_type {
    MouseEvent mouse_event = 9; 
    AddShapeEvent add_shape = 10;
    UpdateShapeEvent update_shape = 11;
    RemoveShapeEvent remove_shape = 12;
    GetBoardEvent board = 13;
    ClientConnectEvent client_connected = 14;
    ClientDisconnectEvent client_disconnect = 15;
  }
}

message ClientDisconnectEvent {
  string client_name = 1;
}

message ClientConnectEvent {
  string client_name = 1;
}

message MouseEvent {
  double x = 1;
  double y = 2;
}

enum ShapeType {
  RECTANGLE = 0;
  ELLIPSE = 1;
}

message Shape {
  // Only optional for frontend client.
  // Backend always creates id
  string id = 1;

  ShapeType type = 2;
  double width = 3;
  double height = 4;
  double x = 5;
  double y = 6;
  string color = 7;
}

message AddShapeEvent {
  string shape_id = 1; // TODO: not needed?
  ShapeType shape_type = 2;
  Shape data = 3;
}

message UpdateShapeEvent {
  string shape_id = 1;
  Shape data = 4;
}

message RemoveShapeEvent {
  string shape_id = 1;
}

message Board {
  string id = 1;
  repeated Shape shapes = 2;
  string name = 3;
}

message GetBoardEvent {
  Board board = 1;
}
